!function e(r,i,t){function o(a,s){if(!i[a]){if(!r[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(n)return n(a,!0);var p=new Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var u=i[a]={exports:{}};r[a][0].call(u.exports,function(e){var i=r[a][1][e];return o(i?i:e)},u,u.exports,e,r,i,t)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<t.length;a++)o(t[a]);return o}({1:[function(e){(function(e){YUI.add("flickr-router",function(r){"use strict";function i(i,t,o){var n,a,s,c,p,u=!1,l="";if(t.headersSent)return r.Flog.debug("[flickr-router]","server render called but headers have already been sent",o&&o.view?"view="+o.view:null,"isBot="+(u?1:0),"timeout="+(i.timeout?1:0)),void 0;if(i&&i.UA&&(i.UA.isBot||i.UA.isSharingBot)&&(u=!0,l=r.fletrics.getBotString()),!o)throw new Error("No view config provide to serverside renderer.");return o.className="html-"+o.view,o.fluid&&(o.className+=" fluid"),o&&o.view&&-1!==["photo-page-scrappy-view","photo-page-lightbox-scrappy-view","search-groups-page-view","search-people-page-view","books-view","books-cover-view","books-spread-view","products-order-view","products-order-shipping-view","products-order-payment-view","products-order-complete-view","subscriptions-order-view","subscriptions-order-payment-view","subscriptions-order-complete-view","mobile-photo-page-view","sohp-view","cameraroll-page-view","cameraroll-comingsoon-page-view","photostream-page-view","albums-list-page-view","album-page-view","favorites-page-view","explore-page-view","groups-list-page-view","group-home-page-view","group-pool-page-view","group-discussions-list-page-view","group-discussion-page-view","group-members-page-view","shared-entity-page-view","person-groups-page-view","stats-view","stats-allphotos-view"].indexOf(o.view)&&(s="page."+o.view.replace(/\-/g,".")+".requests"+l,r.fletrics.increment(s)),o.headers&&o.headers.statusCode&&t.status(o.headers.statusCode),o.redirect?(t.redirect(o.redirect),void 0):o.json?(t.send(o.json),void 0):(a=i.appContext.modelImportExport.exportAll(),c=r.mix({langBundles:["misc"],appContext:i.appContext},r.Localizable),i.appContext&&(p=i.appContext.flipper.isFlipped("disable-client-app")),i.appContext.flipper.prepareForExport(),n={viewName:o.view,viewParams:o.params,modelExport:a,modelRegistries:Object.keys(a),appContext:i.appContext,response:t,title:o.title,className:o.className,language:i.lang.toLowerCase(),layout:o.layout,isMobile:o.isMobile,darkLoader:o.darkLoader,siteName:c.intlMessage({intlName:"misc.DEFAULT_PAGE_TITLE"}),updatedDate:r.moment().toISOString(),clientAppErrorMessage:{oopsMsgTitle:c.intlMessage({intlName:"misc.OOPS"}),oopsMsgMain:c.intlMessage({intlName:"misc.LOADING_ERROR"}),oopsMsgFooter:c.intlMessage({intlName:"misc.REFRESH"})},disableClientApp:p},t.expose(i.appContext.auth,"window.auth"),t.expose(i.id,"window.reqId"),t.expose(i.lang,"window.YUI_config.lang"),t.on("finish",function(){var t,n,a,c={};!e.browser&&YUI.Env.config.debug_request_timing&&i.latencyTimerStart&&i.latencyTimerRouteStart&&i.latencyTimerViewStart&&i.latencyTimerRenderStart&&(a={middleware:YUI.Env.server.diffHrtime(i.latencyTimerStart,i.latencyTimerRouteStart),route:YUI.Env.server.diffHrtime(i.latencyTimerRouteStart,i.latencyTimerViewStart),view:YUI.Env.server.diffHrtime(i.latencyTimerViewStart,i.latencyTimerRenderStart),render:YUI.Env.server.diffHrtime(i.latencyTimerRenderStart,e.hrtime())},c["1. Middleware"]=(1e9*a.middleware[0]+a.middleware[1])/1e6+" ms",c["2. Route"]=(1e9*a.route[0]+a.route[1])/1e6+" ms",c["3. View"]=(1e9*a.view[0]+a.view[1])/1e6+" ms",c["4. Render"]=(1e9*a.render[0]+a.render[1])/1e6+" ms",r.Flog.info("[timing]","[waterfall]","isBot="+(u?1:0),c)),i.latencyTimerStart&&(t=e.hrtime(i.latencyTimerStart),t&&(n=(1e9*t[0]+t[1])/1e6,r.Flog.debug("[res]","view="+o.view,"isBot="+(u?1:0),"latency="+n),o&&o.view&&-1!==["photo-page-scrappy-view","photo-page-lightbox-scrappy-view","mobile-photo-page-view","sohp-view","cameraroll-page-view","cameraroll-comingsoon-page-view","photostream-page-view","albums-list-page-view","album-page-view","favorites-page-view","explore-page-view","groups-list-page-view","group-home-page-view","group-pool-page-view","group-discussions-list-page-view","group-discussion-page-view","group-members-page-view","shared-entity-page-view","person-groups-page-view","stats-view","stats-allphotos-view"].indexOf(o.view)&&(s="page."+o.view.replace(/\-/g,".")+".latency"+l,r.fletrics.set(s,n))))}),new r.Promise(function(e,i){t.emit("render"),t.render(o.view,n,function(n,a){n?(r.Flog.fatal("Client render had an error with the view:",o.view,n.message,n.stack),i(n)):(t.send(a),e(a))})}))}function t(i,t,o){var n,a=this;return o.redirect?(window.location=o.redirect,r.Promise.resolve()):(document.title=o.title,r.loaderBar.progress(),i.appContext.getView(o.view,o.params,o.layout).then(function(e){return r.loaderBar.progress(),n=e,n._params&&(n._params.keyEventScope=n.name+n._yuid),i.appContext.getKeyboardManager().setCurrentKeyEventScope(n.name+n._yuid),n.set("isRootView",!0),n.initialize()}).then(function(){var t,s;r.loaderBar.progress(),t=r.one("html"),s=t.get("className").trim(),s=s.replace(/html-[\S]+-view/,"html-"+o.view),s=s.replace(/[\S]+-layout/,o.layout+"-layout"),s=s.replace("fluid",""),s+=o.fluid?" fluid":"",t.set("className",s),i.transactionId===a.currentTransactionId&&(a.app.showView(n,null,{render:!0,callback:function(){r.loaderBar.finish(),"popstate"!==i.src&&window.scroll(0,0)}}),e.browser&&r.Flog&&r.Flog.timeEnd("[Routing to Activation]"))}).then(null,function(e){throw r.Flog.fatal("Client render had an error:",e.message,e.stack),e}))}var o,n;n="scrolling",r.FlickrRouter=function(r,o){return this.app=r,e.browser?(this.route=r.route.bind(r),this.render=t.bind(this)):(this.route=r.get.bind(r),this.render=i.bind(this)),this.setupRoutes(o),this},r.FlickrRouter.prototype={setupRoutes:function(e){var r,i,t,o,n;for(t in e.patterns)this.registerParam(t,new RegExp(e.patterns[t]));for(r=0;r<e.routes.length;r++)if(o=e.routes[r],o.path instanceof Array)for(i=0;i<o.path.length;i++){n={};for(t in o)"path"!==t&&(n[t]=o[t]);n.path=o.path[i],this.registerRoute(n)}else this.registerRoute(o)},registerParam:function(r,i){e.browser?this.app.param(r,i):this.app.param(r,function(e,r,t,o,n){var a=i.exec(o);a?(e.params[n]=a[0],t()):t("route")})},registerRoute:function(i){var t=this;this.route(i.path,function(i,t,o){e.browser&&r.Flog&&r.Flog.time("[Routing to Activation]"),o()},function(r,i,t){e.browser&&"appContext"in window&&(r.appContext=window.appContext),t()},r.Middleware.MobileRedirect(i),r.Middleware.NormalizeParamsHash(),r.Middleware.NormalizeParam("nsid_or_path_alias"),r.Middleware.NormalizePathParams(),r.Middleware.SetRouteConfig(i),function(e,r,n){return o.bounceRoute(e,r,n,i,t)},function(e,r,t){return o.checkOptIn(e,r,t,i)},function(e,r,t){return o.checkAndKick(e,r,t,i)},function(e,r,t){return o.mixInServerRequest(e,r,t,i)},function(e,r,n){return o.checkAndInterstitial(e,r,n,i,t)},function(e,r,o){t._processRequest(i,e,r,o)})},_processRequest:function(i,t,o,n){var a=this;t.transactionId=r.guid(),this.currentTransactionId=t.transactionId,t.appContext.startTime=Date.now(),t.appContext.getRoute(i.module).then(function(n){var s,c;return a.executingRoute=n,s=e.browser||i.skipAuth?r.when(null):YUI.Env.server.siteAuth.authenticate(t,o),c={id:t.id,isInsecureGod:t.isInsecureGod,cookies:t.cookies,headers:t.headers,params:t.params,url:t.url.toString(),query:t.query,buckets:t.buckets,lang:t.lang,probableUser:t.probableUser,UA:t.UA},t.isGod&&(c.isGod=t.isGod),!e.browser&&YUI.Env.config.debug_request_timing&&(t.latencyTimerRouteStart=e.hrtime()),t.routeTimingStart=Date.now(),r.Promise.all([s,n.run(c,o)])}).then(function(i){return i.length>=2&&(t.appContext.initialView=i[1].view),i[1].isMobile?(r.Flog.debug("[flickr-router] route is being processed as mobile."),i[1].params||(i[1].params={}),i[1].params.isMobile=!0):r.Flog.debug("[flickr-router] route is being processed as desktop."),!e.browser&&YUI.Env.config.debug_request_timing&&(t.latencyTimerViewStart=e.hrtime()),!e.browser&&t.appContext&&t.appContext.flipper.isFlipped("enable-bots-server-rendering")&&(t.appContext.forceServerRender=t.appContext._doForcedServerRender()),a._renderView(i,t,o,n)}).then(null,function(e){return a._throwError.call(a,e,t,o,n)})},_renderView:function(i,t,o){var a,s=i.length>0?i[0]:null,c=i.length>1?i[1]:null;if(!c)throw new Error("Invalid viewConfig");if(s){if(s.signedIn&&s.user&&s.user.username?r.Flog.debug("[site auth]","["+s.user.nsid+"]",s.user.username._content+" is signed in."):r.Flog.debug("[site auth] user is signed out."),s.signedIn&&s.user)for(a in s.user)"undefined"==typeof YUI.Env.config.auth.whitelisted_keys[a]&&delete s.user[a];s.isInsecureGod=t.isInsecureGod,t.appContext.auth=s,t.appContext.initCuratorTools()}return c&&"undefined"!=typeof c.params&&(c.params.isOwner=e.browser?t.appContext.getViewer().signedIn&&t.appContext.getViewer().nsid===c.params.nsid:s&&s.signedIn&&s.user&&s.user.nsid===c.params.nsid),c.redirect?this.render(t,o,c):(c.layout=c.layout||n,c.title=r.pageTitleHelper(c.title),!e.browser&&YUI.Env.config.debug_request_timing&&(t.latencyTimerRenderStart=e.hrtime()),t.appContext.routeTiming=Date.now()-t.routeTimingStart,this.render(t,o,c))},_throwError:function(i,t,o,n){var a,s,c=t&&t.UA&&(t.UA.isBot||t.UA.isSharingBot),p=c?r.fletrics.getBotString():"",u=this;if(o.headersSent)return r.Flog.debug("[flickr-router]","server render called but headers have already been sent","timeout="+(t.timeout?1:0)),void 0;try{if(e.browser||"SiteAuth"!==i.type?(r.fletrics.increment("page.failures"+p),r.Flog.error("[router] Reboot page failure",i.message,t.url),i.fatal?i.timeout||i.clientTimeout?(r.fletrics.increment("api.timeouts"+p),r.Flog.error("Unexpected error: api.timeouts"+p+" | Error: ",i.message)):(r.fletrics.increment("api.other"+p),r.Flog.error("Unexpected error: api.other"+p+" | Error: ",i.message)):(r.fletrics.increment("page.failures.other"+p),r.Flog.error("Unexpected error: page.failures.other | Error: ",i.message+" | isBot: "+c),r.config.win&&r.config.win.beaconError&&r.config.win.beaconError("[flickr-router] Unexpected page failure:"+i.message+" UA:"+(navigator&&navigator.userAgent||"").toString(),r.config.win.location.href,i))):(r.fletrics.increment("siteauth.failures"),i.timeout&&r.fletrics.increment("api.timeouts"),i.failure&&r.fletrics.increment("api.other"),r.Flog.error("[site auth]",i.message)),r.config.win&&r.config.win.beaconError){i.panda=!0;var l="";t&&t.UA&&(l=" unsupported:"+t.UA.isUnsupportedBrowser+" ");var g=["undefined","Script error.","Script error","XHR error"];navigator.userAgent&&(void 0===typeof i.message||g.indexOf(i.message)>-1)&&(i.message=(i.message||"")+(navigator&&navigator.userAgent||"").toString()),r.config.win.beaconError("[flickr-router]"+l+i.message,r.config.win.location.href,i)}}catch(d){var f=d;if("undefined"==typeof u.executingRoute&&(f=i),!e.browser)return n(f),void 0;r.Flog.info(i,i.stack);try{if(r.config.win&&r.config.win.beaconError){i.panda=!0;var g=["undefined","Script error.","Script error","XHR error"];navigator.userAgent&&(void 0===typeof i.message||g.indexOf(i.message)>-1)&&(i.message=(i.message||"")+(navigator&&navigator.userAgent||"").toString()),r.config.win.beaconError("[flickr-router] _throwError failed: "+i.message,r.config.win.location.href,i),f!==i&&r.config.win.beaconError(f.message,r.config.win.location.href,f)}}catch(m){r.Flog.debug("Failed trying to beacon client error.")}}return a=u.executingRoute.display500Error(t,i),s=u.render(t,o,a)}},o={checkAndKick:function(r,i,t,o){return e.browser?(t(),void 0):(YUI.Env.server.bucketOptOut.checkAndKick(r,i,t,o),void 0)},checkAndInterstitial:function(r,i,t){var o;return!e.browser&&r.appContext.flipper.isFlipped("browser-upgrade-interstitial")&&r&&r.headers&&(o=r.get("referer")?r.get("referer"):"",r.UA.isReallyUnsupportedBrowser&&!r.UA.isBot&&!r.UA.isSharingBot&&-1===r.url.indexOf("/browser/upgrade/")&&-1===o.indexOf("/browser/upgrade/"))?i.redirect("/browser/upgrade/?continue="+encodeURIComponent(r.url)):(t(),void 0)},bounceRoute:function(i,t,o,n,a){var s;return e.browser||!YUI.Env.onManhattan||-1!==["gin.flickr.com","gin-flickr.com","staging.gin.flickr.com","staging-gin.flickr.com","smoke.gin.flickr.com","smoke-gin.flickr.com","dev.gin.flickr.com","dev-gin.flickr.com","dev2.gin.flickr.com","dev2-gin.flickr.com","perf.gin.flickr.com","perf-gin.flickr.com","perf2.gin.flickr.com","perf2-gin.flickr.com","perf3.gin.flickr.com","perf3-gin.flickr.com","spike.gin.flickr.com","spike-gin.flickr.com","qa.gin.flickr.com","qa-gin.flickr.com"].indexOf(i.headers.host)||/user-[a-z]+.dev.gin.flickr.com/i.test(i.headers.host)||/[a-z0-9]+.dev.gin.flickr.com/i.test(i.headers.host)||"undefined"!=typeof n.optin||"undefined"!=typeof n.public&&n.public?(o(),void 0):(r.Flog.error("[opt-in] no opt-in specified for "+n.module+" but we are not on gin.flickr.com or dev.gin.flickr.com, showing error page..."),s={view:"error-500-page-view",params:{},layout:"maximized"},(r.config.flickr.error.show_debugging_info||i.isInsecureGod)&&(s.params.source="flickrRouter#bounceRoute",s.params.message="[opt-in] no opt-in specified for "+n.module+" but we are not on gin.flickr.com or dev.gin.flickr.com, showing error page..."),i.id&&(s.params.requestID=r.moment().format("YYYY-MM-DD")+"-"+i.id),a.render(i,t,s))},checkOptIn:function(i,t,o,n){var a,s;return e.browser||!n.optin||i.optins&&0!==i.optins.length&&-1!==i.optins.indexOf(n.optin)?(o(),void 0):(r.Flog.error("[opt-in] "+n.optin+" required for "+n.module+" but user has not opt-ed in to it, bouncing..."),a="https://"+i.headers.host+i.originalUrl,s=r.url(YUI.Env.config.optin.redirect_url+"?redirect_url="+encodeURIComponent(a)),YUI.Env.onManhattan||(s+="&dev=1"),t.redirect(s),void 0)},mixInServerRequest:function(i,t,o){e.browser&&r.mix(i,r.namespace("config.flickr.request")),o()}}},"0.0.1",{requires:["fletrics","flog","oop","page-title-helper","moment","flickr-route","localizable","url","mobile-redirect","normalize-params-hash","normalize-param","normalize-path-params","set-route-config"],langBundles:["misc"]})}).call(this,e("_process"))},{_process:2}],2:[function(e,r){function i(){p=!1,a.length?c=a.concat(c):u=-1,c.length&&t()}function t(){if(!p){var e=setTimeout(i);p=!0;for(var r=c.length;r;){for(a=c,c=[];++u<r;)a&&a[u].run();u=-1,r=c.length}a=null,p=!1,clearTimeout(e)}}function o(e,r){this.fun=e,this.array=r}function n(){}var a,s=r.exports={},c=[],p=!1,u=-1;s.nextTick=function(e){var r=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)r[i-1]=arguments[i];c.push(new o(e,r)),1!==c.length||p||setTimeout(t,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=n,s.addListener=n,s.once=n,s.off=n,s.removeListener=n,s.removeAllListeners=n,s.emit=n,s.binding=function(){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}]},{},[1]);